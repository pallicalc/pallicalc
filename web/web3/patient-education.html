<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Patient Education | PalliCalc</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore-compat.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
/* CORE STYLES */
body {
    font-family: Arial, sans-serif;
    max-width: 480px;
    margin: 20px auto;
    font-size: 14px;
    line-height: 1.5;
    background-color: #fdfdfd;
}

/* NAVIGATION */
.back-nav { text-align: center; margin-bottom: 25px; }
.back-link {
    display: inline-block; color: #007bff; text-decoration: none; font-weight: bold;
    padding: 10px 20px; background: rgba(0, 123, 255, 0.1); border: 2px solid #007bff;
    border-radius: 25px; transition: all 0.3s;
}
.back-link:hover { background: #007bff; color: white; }
.back-link i { margin-right: 6px; }

h1 { color: #007bff; text-align: center; margin-bottom: 30px; font-size: 24px; }

/* INSTITUTION HEADER (DYNAMIC) */
.institution-header {
    background: linear-gradient(135deg, #007bff, #0056b3); color: white;
    padding: 20px; border-radius: 12px; margin-bottom: 25px; text-align: center;
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
}
.logo-container {
    display: flex; justify-content: center; align-items: center; gap: 15px; margin-bottom: 10px;
}
.institution-logo { 
    width: 80px; height: 80px; border-radius: 12px; object-fit: contain;
    background: white; border: 3px solid white; box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
}
.institution-name { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
.institution-contact { font-size: 14px; opacity: 0.95; }

/* Placeholder */
.header-placeholder { 
    background: rgba(0, 123, 255, 0.05); 
    border: 2px dashed #007bff; opacity: 0.6;
    padding: 30px; border-radius: 12px; text-align: center;
}

/* SETTINGS / SHARE CALLOUT */
.action-callout {
    background: linear-gradient(135deg, #fff3cd, #ffeaa7); border: 3px solid #ffc107;
    border-radius: 15px; padding: 20px; margin-bottom: 30px; text-align: center;
    box-shadow: 0 6px 20px rgba(255, 193, 7, 0.3); 
    display: none; /* Hidden by default */
}
.action-callout h3 { color: #856404; margin: 0 0 15px 0; font-size: 18px; }

/* Buttons */
.btn-action { 
    color: white; border: none; padding: 15px 35px; border-radius: 30px; 
    font-size: 16px; font-weight: bold; cursor: pointer; transition: all 0.3s; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: inline-flex; align-items: center; gap: 8px;
}
.btn-settings { background: linear-gradient(135deg, #007bff, #0056b3); }
.btn-share { background: linear-gradient(135deg, #28a745, #218838); } /* Green for sharing */

.btn-action:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.3); }

/* STATUS BANNER */
.source-banner {
    background-color: #e9ecef; border: 1px solid #ced4da; border-radius: 6px;
    padding: 10px; margin-bottom: 20px; text-align: center; font-size: 13px;
    color: #495057; display: none;
}
.source-custom { color: #198754; font-weight: bold; }
.source-shared { color: #6f42c1; font-weight: bold; }
.source-default { color: #6c757d; font-style: italic; }

/* PAMPHLET CARDS */
.pamphlet-section { 
    background: #f8faff; border: 2px solid #007bff; border-radius: 12px;
    padding: 25px; margin-bottom: 30px; text-align: center; 
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.1); 
}
.pamphlet-title { 
    font-size: 22px; font-weight: bold; margin-bottom: 12px; 
    background: linear-gradient(135deg, #007bff, #0056b3); 
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; 
}
.pamphlet-subtitle { color: #555; font-size: 14px; margin-bottom: 20px; font-style: italic; }

.language-icons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
.lang-icon-link { 
    display: flex; flex-direction: column; align-items: center; text-decoration: none;
    padding: 12px; border-radius: 10px; background: white; border: 2px solid #007bff; 
    transition: all 0.3s; min-width: 70px; 
}
.lang-icon-link:hover { 
    background: #007bff; color: white; transform: translateY(-3px); 
    box-shadow: 0 6px 16px rgba(0, 123, 255, 0.4); 
}

/* MODALS */
.modal-overlay { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(4px); }
.modal-content { 
    background-color: white; margin: 10% auto; padding: 25px; border-radius: 12px; 
    width: 90%; max-width: 400px; max-height: 90vh; overflow-y: auto; 
    box-shadow: 0 10px 30px rgba(0,0,0,0.3); text-align: center;
}
.modal-header { 
    display: flex; justify-content: space-between; align-items: center; 
    margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px; 
}
.close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #666; }

/* --- DARK MODE FIX START --- */
/* This specific styling prevents browsers from inverting the QR code */
#qrcode-wrapper-safe {
    background-color: #ffffff !important;
    border-radius: 16px;
    padding: 20px;
    margin: 20px auto;
    text-align: center;
    
    /* Forces the browser to render this element in light mode only */
    color-scheme: light only;
    /* Prevents color blending with dark backgrounds */
    isolation: isolate;
}

#qrcode {
    display: inline-block;
    background-color: #ffffff !important;
    padding: 10px;
    border-radius: 8px;
}

/* Target the images generated by the library */
#qrcode img, 
#qrcode canvas {
    display: block;
    background-color: #ffffff !important;
    /* Adds a white border around the actual code to ensure contrast */
    border: 8px solid #ffffff !important; 
    box-shadow: none;
}
/* --- DARK MODE FIX END --- */

.qr-instruction { font-size: 14px; color: #555; margin-bottom: 20px; }

/* FORM STYLES (Settings) */
.form-group { margin-bottom: 15px; text-align: left; }
.form-group label { display: block; margin-bottom: 6px; font-weight: bold; color: #333; }
.form-group input { 
    width: 100%; padding: 10px; border: 2px solid #ddd; 
    border-radius: 8px; font-size: 14px; box-sizing: border-box; 
}

/* LOGO SELECTION */
.logo-selection-area { margin-bottom: 20px; border: 1px solid #eee; padding: 10px; border-radius: 8px; background: #fafafa; }
.logo-gallery { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px; }
.gallery-item {
    aspect-ratio: 1; border: 2px solid #ddd; border-radius: 8px; cursor: pointer;
    display: flex; align-items: center; justify-content: center; background: white;
    transition: all 0.2s; position: relative; padding: 5px;
}
.gallery-item img { width: 100%; height: 100%; object-fit: contain; }
.gallery-item:hover { border-color: #007bff; transform: scale(1.05); }
.custom-upload-box {
    border: 2px dashed #007bff; padding: 15px; text-align: center;
    border-radius: 8px; cursor: pointer; background: white; margin-top: 10px;
}
.selected-logos-preview {
    display: flex; gap: 10px; margin-top: 10px; min-height: 60px;
    padding: 10px; background: #eee; border-radius: 8px; align-items: center; justify-content: center;
}
.preview-chip {
    position: relative; width: 60px; height: 60px; background: white;
    border-radius: 8px; border: 2px solid #ddd; overflow: hidden;
}
.preview-chip img { width: 100%; height: 100%; object-fit: contain; }
.remove-chip {
    position: absolute; top: 0; right: 0; background: rgba(255,0,0,0.8);
    color: white; border: none; width: 100%; height: 100%; opacity: 0;
    cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px;
}
.preview-chip:hover .remove-chip { opacity: 1; }
.btn-save { background: #28a745; color: white; border: none; padding: 14px; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
.password-error { color: #dc3545; font-size: 13px; margin-top: 5px; display: none; }
.processing-text { display:none; color: #007bff; font-size: 12px; margin-top:5px; text-align: center; font-weight: bold;}
</style>
</head>
<body>

    <script>
        // --- FIREBASE INIT ---
        const firebaseConfig = {
          apiKey: "AIzaSyAioaDxAEh3Cd-8Bvad9RgWXoOzozGeE_s",
          authDomain: "pallicalc-eabdc.firebaseapp.com",
          projectId: "pallicalc-eabdc",
          storageBucket: "pallicalc-eabdc.firebasestorage.app",
          messagingSenderId: "347532270864",
          appId: "1:347532270864:web:bfe5bd1b92ccec22dc5995",
          measurementId: "G-6G9C984F8E"
        };
        
        let auth, db;
        let currentUserRole = "guest";
        let userInstId = null;

        async function initApp() {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.firestore();

            auth.onAuthStateChanged(async (user) => {
                if (user) {
                    try {
                        const snap = await db.collection('users').doc(user.uid).get();
                        if (snap.exists) {
                            const data = snap.data();
                            currentUserRole = data.role || "personal";
                            userInstId = data.institutionId || null;
                        }
                    } catch (e) { console.error(e); }
                } else {
                    currentUserRole = "guest";
                }
                applyViewLogic();
            });
        }

        async function applyViewLogic() {
            const settingsSection = document.getElementById('settingsCallout');
            const shareSection = document.getElementById('shareCallout');
            
            // 1. PUBLIC VIEW: Check URL for ?ref= (Shared Link)
            const urlParams = new URLSearchParams(window.location.search);
            const sharedRef = urlParams.get('ref');

            if (sharedRef) {
                // Public viewing a shared link
                settingsSection.style.display = 'none';
                shareSection.style.display = 'none';
                await loadInstitutionFromFirebase(sharedRef, true);
                return;
            }

            // 2. INSTITUTION STAFF VIEW (Logged in)
            if ((currentUserRole === 'institutionUser' || currentUserRole === 'institutionAdmin') && userInstId) {
                // Auto-load data
                await loadInstitutionFromFirebase(userInstId, false);
                
                // Show SHARE button, Hide SETUP button
                settingsSection.style.display = 'none';
                shareSection.style.display = 'block';
            } 
            // 3. PERSONAL/GUEST VIEW (Default)
            else {
                // Show SETUP button, Hide SHARE button
                settingsSection.style.display = 'block';
                shareSection.style.display = 'none';
                loadLocalSettings();
            }
        }

        function updateBanner(type, sourceName) {
            const banner = document.getElementById('sourceBanner');
            banner.style.display = 'block';
            
            if (type === 'shared') {
                banner.innerHTML = `<strong>Viewing Shared Page:</strong> <span class="source-shared">${sourceName}</span>`;
            } else if (type === 'custom_firebase') {
                banner.innerHTML = `<strong>${sourceName}:</strong> <span class="source-custom">Official Header Loaded</span>`;
            } else if (type === 'custom_local') {
                banner.innerHTML = `<strong>Personal User:</strong> <span class="source-custom">Custom Header (Local)</span>`;
            } else if (type === 'default_institution') {
                 banner.innerHTML = `<strong>${sourceName}:</strong> <span class="source-default">Default Header (Not configured by Admin)</span>`;
            } else {
                banner.style.display = 'none';
            }
        }

        // --- DATA LOADING ---
        function loadLocalSettings() {
            const settings = JSON.parse(localStorage.getItem('institutionSettings') || '{}');
            if (settings.name && settings.contact) {
                renderHeader(settings);
                updateBanner('custom_local');
            } else {
                renderPlaceholder();
            }
        }

        async function loadInstitutionFromFirebase(instId, isSharedLink) {
            try {
                const doc = await db.collection('institutions').doc(instId).get();
                if (doc.exists) {
                    const data = doc.data();
                    if (data.headerName && data.headerContact) {
                        renderHeader({
                            name: data.headerName,
                            contact: data.headerContact,
                            logos: data.headerLogos || [] 
                        });
                        updateBanner(isSharedLink ? 'shared' : 'custom_firebase', data.name);
                    } else {
                        renderPlaceholder();
                        if (!isSharedLink) updateBanner('default_institution', data.name);
                    }
                } else {
                    renderPlaceholder();
                }
            } catch (e) {
                console.error(e);
                renderPlaceholder();
            }
        }

        function renderHeader(settings) {
            const header = document.getElementById('institutionHeader');
            const placeholder = document.getElementById('headerPlaceholder');
            const logoContainer = document.getElementById('headerLogoContainer');
            
            placeholder.style.display = 'none';
            header.style.display = 'block';
            logoContainer.innerHTML = '';
            
            if (settings.logos && settings.logos.length > 0) {
                settings.logos.forEach(src => {
                    const img = document.createElement('img');
                    img.src = src;
                    img.className = 'institution-logo';
                    logoContainer.appendChild(img);
                });
            }
            document.getElementById('institutionName').textContent = settings.name;
            document.getElementById('institutionContact').textContent = `Contact: ${settings.contact}`;
        }

        function renderPlaceholder() {
            document.getElementById('institutionHeader').style.display = 'none';
            document.getElementById('headerPlaceholder').style.display = 'block';
        }

        // --- QR GENERATION ---
        function openShareModal() {
            if (!userInstId) return alert("Institution ID not found.");
            
            const modal = document.getElementById('shareModal');
            const qrDiv = document.getElementById('qrcode');
            const shareLink = document.getElementById('shareLink');
            
            // Construct URL: current_page + ?ref=INST_ID
            // Removing any existing query params first to be clean
            const baseUrl = window.location.origin + window.location.pathname;
            const fullUrl = `${baseUrl}?ref=${userInstId}`;

            // Generate QR
            qrDiv.innerHTML = ""; // Clear previous
            new QRCode(qrDiv, {
                text: fullUrl,
                width: 200,
                height: 200,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });

            shareLink.textContent = fullUrl;
            modal.style.display = 'block';
        }

        function closeShareModal() {
            document.getElementById('shareModal').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', initApp);
    </script>

    <div class="back-nav">
        <a href="index.html" class="back-link"><i class="bi bi-arrow-left"></i> Back</a>
    </div>

    <div id="sourceBanner" class="source-banner"></div>

    <div id="institutionHeader" class="institution-header" style="display: none;">
        <div id="headerLogoContainer" class="logo-container"></div>
        <div id="institutionName" class="institution-name"></div>
        <div id="institutionContact" class="institution-contact"></div>
    </div>

    <div id="headerPlaceholder" class="header-placeholder">
        <div style="font-size: 30px; margin-bottom: 10px;">🏥</div>
        <div style="font-style: italic; opacity: 0.8;">Institution header will appear here</div>
    </div>

    <div id="settingsCallout" class="action-callout">
        <h3>🏥 Setup Personal Header</h3>
        <p><strong>Add Logos & Contact Info</strong><br>Customize pamphlets for your own practice.</p>
        <button class="btn-action btn-settings" onclick="openSettings()">
            <i class="bi bi-gear-fill"></i> Setup Custom Settings
        </button>
    </div>

    <div id="shareCallout" class="action-callout" style="background: linear-gradient(135deg, #dcfce7, #bbf7d0); border-color: #22c55e;">
        <h3>📱 Share with Patient</h3>
        <p><strong>Auto-Generated QR Code</strong><br>Patient will see your institution's header automatically.</p>
        <button class="btn-action btn-share" onclick="openShareModal()">
            <i class="bi bi-qr-code"></i> Generate Patient QR
        </button>
    </div>

    <h1>Patient Education Materials</h1>

    <section class="pamphlets-available">
        <div class="pamphlet-section" data-pamphlet="opioids">
            <div class="pamphlet-title">What are Opioids?</div>
            <div class="pamphlet-subtitle">Myth busting Opioid Medications</div>
            <div class="language-icons" data-langs="en,zh,ms"></div>
        </div>
    </section>

    <div id="settingsModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin:0; font-size: 18px;">🏥 Custom Header Settings</h2>
                <button class="close-btn" onclick="closeSettings()">&times;</button>
            </div>
            <p style="font-size:12px; color:#666; margin-bottom:15px;">Settings saved to this device only.</p>
            
            <form id="institutionForm">
                <div class="form-group">
                    <label>Logos (Select max 2)</label>
                    <div class="logo-selection-area">
                        <div class="logo-gallery" id="logoGallery"></div>
                        <div class="custom-upload-box" id="uploadTrigger">
                            <i class="bi bi-cloud-upload"></i> Upload Logo
                            <input type="file" id="logoFileInput" accept="image/*" style="display: none;">
                        </div>
                        <div id="processingText" class="processing-text">🔄 Processing...</div>
                        <div class="selected-logos-preview" id="selectedLogosPreview"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="institutionNameInput">Institution Name</label>
                    <input type="text" id="institutionNameInput" required>
                </div>
                <div class="form-group">
                    <label for="institutionContactInput">Contact Number</label>
                    <input type="tel" id="institutionContactInput" required>
                </div>
                <div class="form-group" style="margin-top: 20px;">
                    <label>🔐 Login Password</label>
                    <input type="password" id="loginPassword" required>
                    <div class="password-error" id="passwordError">❌ Password incorrect.</div>
                </div>
                <button type="submit" class="btn-save" id="saveBtn">💾 Save Settings</button>
            </form>
        </div>
    </div>

    <div id="shareModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 style="margin:0; font-size: 18px;">📱 Scan to View</h2>
                <button class="close-btn" onclick="closeShareModal()">&times;</button>
            </div>
            <div class="qr-instruction">
                Ask the patient to scan this code.<br>They will see the page with <strong>your</strong> institution's header.
            </div>
            
            <div id="qrcode-wrapper-safe">
                <div id="qrcode"></div>
            </div>

            <div style="margin-top:20px; font-size:11px; color:#999; word-break: break-all;">
                Link: <span id="shareLink"></span>
            </div>
        </div>
    </div>

<script>
// --- CONFIG & UTILS (Same as before) ---
const pamphletConfig = {
    languages: { 
        en: { flag: '🇬🇧', label: 'English', file: 'opioids-english.html' },
        zh: { flag: '🇨🇳', label: '中文', file: 'opioids-chinese.html' },
        ms: { flag: '🇲🇾', label: 'Bahasa', file: 'opioids-malay.html' } 
    },
    pamphlets: { opioids: { langs: ['en', 'zh', 'ms'] } }
};

const preAddedLogos = [
    { id: 'palli', src: 'icon-512.png', label: 'PalliCalc' },
    { id: 'kkm', src: 'kkm-logo.png', label: 'KKM' },
    { id: 'pc', src: 'pc-logo.png', label: 'PC' }
];

let currentSelectedLogos = [];

document.addEventListener('DOMContentLoaded', function() {
    generatePamphletIcons();
    renderGallery();
});

// Settings Modal Logic
function openSettings() { 
    document.getElementById('settingsModal').style.display = 'block';
    const settings = JSON.parse(localStorage.getItem('institutionSettings') || '{}');
    document.getElementById('institutionNameInput').value = settings.name || '';
    document.getElementById('institutionContactInput').value = settings.contact || '';
    currentSelectedLogos = settings.logos || [];
    updateLogoUI();
}
function closeSettings() {
    document.getElementById('settingsModal').style.display = 'none';
    document.getElementById('passwordError').style.display = 'none';
}

// Logo Logic
function renderGallery() {
    const gallery = document.getElementById('logoGallery');
    gallery.innerHTML = '';
    preAddedLogos.forEach(logo => {
        const div = document.createElement('div');
        div.className = 'gallery-item';
        div.innerHTML = `<img src="${logo.src}">`;
        div.onclick = () => selectGalleryLogo(logo.src);
        gallery.appendChild(div);
    });
}
function selectGalleryLogo(src) {
    if (currentSelectedLogos.length >= 2) return alert("Max 2 logos.");
    const img = new Image(); img.crossOrigin = "Anonymous"; img.src = src;
    img.onload = function() {
        compressImageToDataUrl(img, 400, 0.7, (base64) => {
            currentSelectedLogos.push(base64);
            updateLogoUI();
        });
    };
}
function updateLogoUI() {
    const container = document.getElementById('selectedLogosPreview');
    container.innerHTML = currentSelectedLogos.length === 0 ? '<span style="color:#999; font-size:12px;">No logos</span>' : '';
    currentSelectedLogos.forEach((src, index) => {
        const chip = document.createElement('div');
        chip.className = 'preview-chip';
        chip.innerHTML = `<img src="${src}"><button class="remove-chip" onclick="currentSelectedLogos.splice(${index}, 1); updateLogoUI();"><i class="bi bi-trash"></i></button>`;
        container.appendChild(chip);
    });
}
document.getElementById('uploadTrigger').addEventListener('click', () => {
    if (currentSelectedLogos.length >= 2) return alert("Max 2 logos.");
    document.getElementById('logoFileInput').click();
});
document.getElementById('logoFileInput').addEventListener('change', (e) => {
    if(e.target.files[0]) {
        const reader = new FileReader();
        reader.readAsDataURL(e.target.files[0]);
        reader.onload = ev => {
            const img = new Image(); img.src = ev.target.result;
            img.onload = () => compressImageToDataUrl(img, 400, 0.7, (b64) => {
                currentSelectedLogos.push(b64); updateLogoUI();
            });
        };
    }
});
function compressImageToDataUrl(imgObj, maxWidth, quality, callback) {
    let w = imgObj.width, h = imgObj.height;
    if (w > h) { if (w > maxWidth) { h *= maxWidth / w; w = maxWidth; } } 
    else { if (h > maxWidth) { w *= maxWidth / h; h = maxWidth; } }
    const canvas = document.createElement('canvas');
    canvas.width = w; canvas.height = h;
    const ctx = canvas.getContext('2d');
    ctx.fillStyle = '#FFFFFF'; ctx.fillRect(0, 0, w, h);
    ctx.drawImage(imgObj, 0, 0, w, h);
    callback(canvas.toDataURL('image/jpeg', quality));
}

// Save Form
document.getElementById('institutionForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const pwd = document.getElementById('loginPassword').value;
    const savedPwd = localStorage.getItem('palliCalcLoginPassword');
    if (savedPwd && pwd !== savedPwd) {
        document.getElementById('passwordError').style.display = 'block';
        return;
    }
    const settings = {
        name: document.getElementById('institutionNameInput').value.trim(),
        contact: document.getElementById('institutionContactInput').value.trim(),
        logos: currentSelectedLogos
    };
    localStorage.setItem('institutionSettings', JSON.stringify(settings));
    loadLocalSettings();
    const saveBtn = document.getElementById('saveBtn');
    saveBtn.textContent = '✅ Saved!';
    setTimeout(() => { closeSettings(); saveBtn.textContent = '💾 Save Settings'; }, 1000);
});

// Modals close on click outside
window.onclick = function(event) {
    if (event.target.classList.contains('modal-overlay')) {
        event.target.style.display = 'none';
    }
};

function generatePamphletIcons() {
    const params = new URLSearchParams(window.location.search);
    const ref = params.get('ref');

    Object.entries(pamphletConfig.pamphlets).forEach(([id, config]) => {
        const section = document.querySelector(`[data-pamphlet="${id}"] .language-icons`);
        if (!section) return;

        section.innerHTML = '';
        config.langs.forEach(langCode => {
            const lang = pamphletConfig.languages[langCode];
            const link = document.createElement('a');

            link.href = ref
                ? `${lang.file}?ref=${ref}`
                : lang.file;

            link.className = 'lang-icon-link';
            link.innerHTML = `
              <div class="lang-icon">${lang.flag}</div>
              <div class="lang-label">${lang.label}</div>
            `;
            section.appendChild(link);
        });
    });
}
</script>
</body>
</html>