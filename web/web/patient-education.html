<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Patient Education | PalliCalc</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
<style>
body {
font-family: Arial, sans-serif;
max-width: 480px;
margin: 20px auto;
font-size: 14px;
line-height: 1.5;
}
.back-nav { text-align: center; margin-bottom: 25px; }
.back-link {
display: inline-block; color: #007bff; text-decoration: none; font-weight: bold;
padding: 10px 20px; background: rgba(0, 123, 255, 0.1); border: 2px solid #007bff;
border-radius: 25px; transition: all 0.3s;
}
.back-link:hover { background: #007bff; color: white; }
.back-link i { margin-right: 6px; }
h1 { color: #007bff; text-align: center; margin-bottom: 30px; font-size: 24px; }

/* INSTITUTION HEADER */
.institution-header {
background: linear-gradient(135deg, #007bff, #0056b3); color: white;
padding: 20px; border-radius: 12px; margin-bottom: 25px; text-align: center;
box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
}
.institution-logo { width: 80px; height: 80px; border-radius: 50%; object-fit: cover;
margin: 0 auto 10px auto; display: block; border: 4px solid white; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
.institution-name { font-size: 20px; font-weight: bold; margin-bottom: 5px; }
.institution-contact { font-size: 14px; opacity: 0.95; }
.header-placeholder { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
border: 2px dashed rgba(255,255,255,0.5); padding: 30px; border-radius: 12px; }
.header-placeholder-text { font-size: 16px; font-style: italic; opacity: 0.8; }

/* PROMINENT SETTINGS */
.settings-callout {
background: linear-gradient(135deg, #fff3cd, #ffeaa7); border: 3px solid #ffc107;
border-radius: 15px; padding: 20px; margin-bottom: 30px; text-align: center;
box-shadow: 0 6px 20px rgba(255, 193, 7, 0.3); animation: pulse 2s infinite;
}
@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
.settings-callout h3 { color: #856404; margin: 0 0 15px 0; font-size: 18px; }
.settings-callout p { color: #856404; margin: 0 0 20px 0; font-size: 14px; }
.btn-settings { background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none;
padding: 15px 35px; border-radius: 30px; font-size: 16px; font-weight: bold; cursor: pointer;
transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,123,255,0.4); }
.btn-settings:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,123,255,0.5); }

/* PAMPHLET STYLES */
.pamphlet-section { background: #f8faff; border: 2px solid #007bff; border-radius: 12px;
padding: 25px; margin-bottom: 30px; text-align: center; box-shadow: 0 4px 12px rgba(0, 123, 255, 0.1); }
.pamphlet-title { font-size: 22px; font-weight: bold; margin-bottom: 12px; color: #007bff;
background: linear-gradient(135deg, #007bff, #0056b3); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
.pamphlet-subtitle { color: #555; font-size: 14px; margin-bottom: 20px; font-style: italic; }
.language-icons { display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; }
.lang-icon-link { display: flex; flex-direction: column; align-items: center; text-decoration: none;
padding: 12px; border-radius: 10px; background: white; border: 2px solid #007bff; transition: all 0.3s; min-width: 70px; }
.lang-icon-link:hover { background: #007bff; color: white; transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0, 123, 255, 0.4); }
.lang-icon { font-size: 24px; margin-bottom: 4px; }
.lang-label { font-size: 12px; font-weight: 500; }

/* SETTINGS MODAL */
.settings-modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
.settings-content { background-color: white; margin: 10% auto; padding: 30px; border-radius: 12px; width: 90%; max-width: 450px; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
.settings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #007bff; }
.close-settings { background: none; border: none; font-size: 24px; cursor: pointer; color: #666; }
.form-group { margin-bottom: 20px; }
.form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
.form-group input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; box-sizing: border-box; }
.logo-upload { border: 2px dashed #007bff; padding: 40px; text-align: center; border-radius: 12px; cursor: pointer; transition: all 0.3s; background: #f8faff; }
.logo-upload.dragover { background: #e3f2fd; border-color: #0056b3; }
.btn-save { background: linear-gradient(135deg, #007bff, #0056b3); color: white; border: none; padding: 14px 30px; border-radius: 25px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; transition: all 0.3s; }
.password-error, .no-password-error { color: #dc3545; font-size: 13px; margin-top: 5px; display: none; }
.footer { text-align: center; margin-top: 50px; padding-top: 25px; border-top: 1px solid #ddd; color: #666; font-size: 13px; }
</style>
</head>
<body>
<div class="back-nav">
<a href="index.html" class="back-link"><i class="bi bi-arrow-left"></i> Back</a>
</div>

<!-- INSTITUTION HEADER -->
<div id="institutionHeader" class="institution-header" style="display: none;">
<img id="institutionLogo" class="institution-logo" alt="Institution Logo">
<div id="institutionName" class="institution-name"></div>
<div id="institutionContact" class="institution-contact"></div>
</div>
<div id="headerPlaceholder" class="header-placeholder">
<div class="header-placeholder-text">🏥 Institution header will appear here after setup</div>
</div>

<div class="settings-callout">
<h3>🏥 Setup Your Institution</h3>
<p><strong>Save your clinic/hospital logo, name & contact number</strong><br>Appears automatically on all education pamphlets</p>
<button class="btn-settings" onclick="openSettings()">⚙️ Setup Institution Settings</button>
</div>

<h1>Patient Education Materials</h1>

<section class="pamphlets-available">
<div class="pamphlet-section" data-pamphlet="opioids">
<div class="pamphlet-title">What are Opioids?</div>
<div class="pamphlet-subtitle">Myth busting Opioid Medications</div>
<div class="language-icons" data-langs="en,zh,ms"></div>
</div>
</section>

<section class="pamphlets-upcoming">
<div class="coming-soon" style="background: #fff3cd; border: 2px solid #ffc107; color: #856404; padding: 25px; border-radius: 12px; text-align: center; margin-top: 20px; box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);">
<h3 style="color: #856404; margin-top: 0; margin-bottom: 20px; font-size: 20px;">📚 Coming Soon</h3>
<ul style="text-align: center; list-style: none; padding: 0; margin: 0 0 15px 0;">
<li style="font-size: 16px; margin: 12px 0; font-weight: 500; background: rgba(255, 193, 7, 0.1); padding: 8px 16px; border-radius: 20px; display: inline-block;">Fentanyl Patch Applications</li>
<li style="font-size: 16px; margin: 12px 0; font-weight: 500; background: rgba(255, 193, 7, 0.1); padding: 8px 16px; border-radius: 20px; display: inline-block;">End-of-Life Symptoms Control</li>
</ul>
<p style="font-size: 13px; opacity: 0.9; margin: 0;">Practical guides for patients & families</p>
</div>
</section>

<!-- SETTINGS MODAL -->
<div id="settingsModal" class="settings-modal">
<div class="settings-content">
<div class="settings-header">
<h2>🏥 Institution Settings</h2>
<button class="close-settings" onclick="closeSettings()">&times;</button>
</div>
<form id="institutionForm">
<div class="form-group">
<label for="institutionNameInput">Institution/Clinic Name</label>
<input type="text" id="institutionNameInput" placeholder="e.g., Putra Heights Medical Centre" required>
</div>
<div class="form-group">
<label for="institutionContactInput">Contact Number</label>
<input type="tel" id="institutionContactInput" placeholder="+60 3-5123 4567" required>
</div>
<div class="form-group">
<label>Logo (Optional)</label>
<div class="logo-upload" id="logoUpload">
<i class="bi bi-cloud-upload" style="font-size: 48px; color: #007bff; margin-bottom: 10px;"></i>
<div>Click/Drop to upload logo<br><small>PNG/JPG, max 1MB, square recommended</small></div>
<input type="file" id="logoFileInput" accept="image/*" style="display: none;">
</div>
<div id="currentLogoPreview" style="margin-top: 10px; display: none;">
<img id="logoPreview" style="width: 60px; height: 60px; border-radius: 8px; object-fit: cover;">
<small>Current logo (will be updated)</small>
</div>
</div>
<div class="form-group">
<label for="loginPassword">🔐 Login Password</label>
<input type="password" id="loginPassword" placeholder="Enter login password from index.html" required autocomplete="off">
<div class="password-error" id="passwordError">❌ Password does not match your homepage login.</div>
<div class="no-password-error" id="noPasswordError">ℹ️ Please login on homepage first to set password.</div>
</div>
<button type="submit" class="btn-save" id="saveBtn">💾 Save Institution Settings</button>
</form>
</div>
</div>

<div class="footer">
<p>PalliCalc Patient Education | For palliative care in Malaysia 🇲🇾</p>
</div>

<script>
const pamphletConfig = {
  languages: { 
    en: { flag: '🇬🇧', label: 'English', file: 'opioids-english.html' },
    zh: { flag: '🇨🇳', label: '中文', file: 'opioids-chinese.html' },
    ms: { flag: '🇲🇾', label: 'Bahasa', file: 'opioids-malay.html' } 
  },
  pamphlets: { 
    opioids: { langs: ['en', 'zh', 'ms'] } 
  }
};

function loadInstitutionSettings() {
  const settings = JSON.parse(localStorage.getItem('institutionSettings') || '{}');
  const header = document.getElementById('institutionHeader');
  const placeholder = document.getElementById('headerPlaceholder');
  
  if (settings.name && settings.contact) {
    placeholder.style.display = 'none';
    header.style.display = 'block';
    
    // Logo
    const logoImg = document.getElementById('institutionLogo');
    if (settings.logo) {
      logoImg.src = settings.logo;
      logoImg.style.display = 'block';
    }
    
    // Name
    const nameDiv = document.getElementById('institutionName');
    nameDiv.textContent = settings.name;
    
    // Contact
    const contactDiv = document.getElementById('institutionContact');
    contactDiv.textContent = `Contact: ${settings.contact}`;
  }
}

function openSettings() { 
  document.getElementById('settingsModal').style.display = 'block'; 
  loadCurrentSettingsToForm(); 
}

function closeSettings() {
  document.getElementById('settingsModal').style.display = 'none';
  document.getElementById('passwordError').style.display = 'none';
  document.getElementById('noPasswordError').style.display = 'none';
}

function loadCurrentSettingsToForm() {
  const settings = JSON.parse(localStorage.getItem('institutionSettings') || '{}');
  document.getElementById('institutionNameInput').value = settings.name || '';
  document.getElementById('institutionContactInput').value = settings.contact || '';
  if (settings.logo) {
    document.getElementById('logoPreview').src = settings.logo;
    document.getElementById('currentLogoPreview').style.display = 'block';
  }
}

// Logo handling
const logoUpload = document.getElementById('logoUpload');
const logoFileInput = document.getElementById('logoFileInput');

logoUpload.addEventListener('click', () => logoFileInput.click());

logoFileInput.addEventListener('change', function(e) {
  handleLogoFile(e.target.files[0]);
});

['dragenter', 'dragover', 'dragleave', 'drop'].forEach(event => {
  logoUpload.addEventListener(event, e => e.preventDefault());
});

['dragenter', 'dragover'].forEach(event => {
  logoUpload.addEventListener(event, () => logoUpload.classList.add('dragover'));
});

['dragleave', 'drop'].forEach(event => {
  logoUpload.addEventListener(event, () => logoUpload.classList.remove('dragover'));
});

logoUpload.addEventListener('drop', e => {
  handleLogoFile(e.dataTransfer.files[0]);
});

function handleLogoFile(file) {
  if (file && file.size <= 1024 * 1024 && file.type.startsWith('image/')) {
    const reader = new FileReader();
    reader.onload = e => { 
      document.getElementById('logoPreview').src = e.target.result; 
      document.getElementById('currentLogoPreview').style.display = 'block'; 
    };
    reader.readAsDataURL(file);
  } else {
    alert('Please select a valid image file under 1MB');
  }
}

// FORM SUBMISSION
document.getElementById('institutionForm').addEventListener('submit', function(e) {
  e.preventDefault();

  const pwd = document.getElementById('loginPassword').value;
  const savedPwd = localStorage.getItem('palliCalcLoginPassword');
  const msgError = document.getElementById('passwordError');
  const msgNoPwd = document.getElementById('noPasswordError');

  msgError.style.display = 'none';
  msgNoPwd.style.display = 'none';

  if (!savedPwd) {
    msgNoPwd.textContent = 'Please login on homepage first to set password.';
    msgNoPwd.style.display = 'block';
    return false;
  }
  
  if (pwd !== savedPwd) {
    msgError.textContent = 'Password does not match your homepage login.';
    msgError.style.display = 'block';
    return false;
  }

  // Save settings
  const settings = {
    name: document.getElementById('institutionNameInput').value.trim(),
    contact: document.getElementById('institutionContactInput').value.trim(),
    logo: document.getElementById('logoPreview').src || ''
  };
  
  localStorage.setItem('institutionSettings', JSON.stringify(settings));
  loadInstitutionSettings();

  // Success feedback
  const saveBtn = document.getElementById('saveBtn');
  saveBtn.textContent = '✅ Settings saved successfully!';
  saveBtn.style.background = '#28a745';
  document.getElementById('loginPassword').value = '';
  
  setTimeout(() => {
    closeSettings();
    saveBtn.textContent = '💾 Save Institution Settings';
    saveBtn.style.background = '';
  }, 2000);
});

// Close on outside click
window.onclick = function(event) {
  if (event.target.id === 'settingsModal') {
    closeSettings();
  }
};

function generatePamphletIcons() {
  Object.entries(pamphletConfig.pamphlets).forEach(([id, config]) => {
    const section = document.querySelector(`[data-pamphlet="${id}"] .language-icons`);
    if (!section) return;
    
    section.innerHTML = '';
    config.langs.forEach(langCode => {
      const lang = pamphletConfig.languages[langCode];
      if (lang) {
        const link = document.createElement('a');
        link.href = lang.file; // CHANGED: Removed 'pamphlets/' prefix
        link.className = 'lang-icon-link';
        link.rel = 'noopener';
        link.innerHTML = `
          <div class="lang-icon">${lang.flag}</div>
          <div class="lang-label">${lang.label}</div>
        `;
        section.appendChild(link);
      }
    });
  });
}

document.addEventListener('DOMContentLoaded', function() {
  loadInstitutionSettings();
  generatePamphletIcons();
});
</script>
</body>
</html>
